<% title "Add an Bookmark to Line Of Thought" %>

<section id="content" class="main">
  <h2><%= @title %></h2>
  <section>
    <% if @link && @link.parsed? %>
      <%= render 'form' %>
    <% else%>
      <%= semantic_form_for @bookmark, :url => lookup_bookmarks_path, :html => { :id => "lookup_bookmark", :remote => true } do |f| %>
        <%= f.inputs do %>
          <%= f.input :url, :as => :string, :required => true, :label => "Bookmark URL" %>
          <%= f.commit_button :label => "Step 2 >>", :id => "lookup_submit" %>
          <li id="lookup_loading" style="display:none;"> <img src="/images/spinner.gif"/> We're looking up this link, just a sec.</li>
        <% end %>
      <% end %>
      <div id="edit_bookmark_form"></div>
      
      <% javascript do %>
      var checkForLookup = false
      $(function() {
        $("#lookup_bookmark").submit(function() {
          if(!checkForLookup) {
            $("#lookup_bookmark input.create").attr("disabled", "disabled");
            $("#lookup_loading").show();
            checkForLookup = setInterval("resubmit_lookup()", 5000);
          }
        });
      })
      
      function resubmit_lookup() {
        $("#lookup_bookmark").submit();
      }
      <% end %>
    <% end %>
  </section>
</section>

<sidebar>
  <aside>
    <h3>Bookmarklet</h3>
    <ul>
      <li><%= link_to "Add Bookmark to LoT", "javascript:(function(){f='#{new_bookmark_url(:format => "popup")}?article[url]='+encodeURIComponent(window.location.href)+'&article[title]='+encodeURIComponent(document.title);a=function(){if(!window.open(f,'lot-new-article','location=yes,links=no,scrollbars=no,toolbar=no,width=625,height=550'))location.href=f};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})()" %></li>
    </ul>
  </aside>
</sidebar>