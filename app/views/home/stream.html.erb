<% title "Current Activity" %>
<section id="content" class="main site">
  <h2><%= @title %></h2>
  <p>Here's what's going on right now.</p>
  <ul id="activity"></ul>

</section>

<sidebar>
  <aside>
    <h3>Filter Activity</h3>
    <ul>
      test
    </ul>
  </aside>
</sidebar>


<% javascript_files do %>
  <script src="http://js.pusherapp.com/1.8/pusher.min.js" type="text/javascript"></script>
<% end %>

<% javascript do %>
$(function() {
  var pusher = new Pusher('<%= Pusher.key %>');
  var channel = pusher.subscribe('stream');
  channel.bind('signup', function(data) {
    var source = '<li class="signup">User <a href="/profiles/{{username}}"><img src="{{avatar}}" />{{username}} signed up.</li>';
    output(data, source)
  });
  channel.bind('site', function(data) {
    var source = '<li class="site">The site <a href="/sites/{{param}}">{{title}}</a> was added.</li>';
    output(data, source)
  });
  channel.bind('tool', function(data) {
    var source = '<li class="tool">The Tool <a href="/tools/{{param}}">{{name}}</a> was added.</li>';
    output(data, source)
  });
  channel.bind('using', function(data) {
    var source = '<li class="using"><a href="/sites/{{site_param}}">{{site_title}}</a> is now using <a href="/tools/{{tool_param}}">{{tool_name}}</a>.</li>';
    output(data, source)
  });
  channel.bind('bookmark', function(data) {
    var source = '<li class="bookmark">A bookmark for <a href="/bookmarks/{{param}}">{{title}}</a> was added.</li>';
    output(data, source)
  });
  
  function output(data, source) {
    var template = Handlebars.compile(source);
    var result = template(data);
    $("#activity").append(result);
  }
});
<% end %>